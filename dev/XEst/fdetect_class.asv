classdef fdetect_class < matlab.System 
  properties % public vars
    %% features 
    mat_feat_sav_fig_en   = true;
    mat_feat_disp_fig_en  = false; % disp matched features between two keyframes
    mat_feat_sav_pts_en   = false; 
    %% cfg argin
    TID
    ttag
    toutDir
    benchmark
    %pos_algs
    %vel_algs  
    %% private vars
    mats  % current frame feature points 
    m_dot % m(i) - m(i-1) of matched feature points  
    % rpt constants 
    mod_name    = 'fdetect'
    rpt_note    = " "
  end
  methods % constructor
    
    function obj = fdetect_class(varargin) 
      setProperties(obj,nargin,varargin{:}) % init obj w name-value args
    end  
  
  end 
  methods (Access = public) 
  
    function load_cfg(obj, cfg)
      obj.TID            = cfg.TID;                   
      obj.ttag           = cfg.ttag;                   
      obj.toutDir        = cfg.toutDir;
      obj.benchmark      = cfg.benchmark;
      obj.init();
    end

    function get_mats(obj, kfi, dat) 
      % get current frame features and match w prev frame    
      [dat.npoints,dat.In] = GetFeaturePoints(kfi, dat.dataset, dat.surfThresh);            
      dat.matches   = MatchFeaturePoints(dat.Ip, ...
                                         dat.ppoints, ...
                                         dat.In, ...
                                         dat.npoints, ...
                                         obj.maxPts, ...
                                         dat.dataset, ...
                                         kfi, ...
                                         obj.mat_feat_disp_fig_en, ... 
                                         obj.mat_feat_sav_fig_en, ...
                                         obj.toutDir, ...
                                         obj.mat_feat_sav_pts_en);
      [dat.relPose, dat.posp] = RelativeGroundTruth(kfi, dat.posp, dat.dataset);
    end 

    function res = get_res(obj, cfg, dlog)
    
    end % get_res()      

    function  [v_err, w_err] = get_err(obj, idx, v, w)
      v = obj.normalize(v);
      w = obj.normalize(w);
      v_err = 1/pi * acos(v' * obj.v_gt(idx,:));
      w_err = sqrt(   (w - obj.w_gt(idx))^2   );
    end 

  end % end of public access 
  methods (Access = private)
    
    function init(obj)
      %obj.numBenchmarks         = length(obj.benchmarks);
      obj.pos_numMethods        = length(obj.pos_algs);
      obj.vel_numMethods        = length(obj.vel_algs);
      obj.res                   = cell(3,0); % benchmark, res_tab, res_fig
    end 

    function stats = get_stats(~, errs) 
    
    end
    
  

    %% Backup/restore functions
    function s = save(obj)
      % Set properties in structure s to values in object obj
      % Set public properties and states
      s = save@matlab.System(obj);
      % Set private and protected properties
      %s.myproperty = obj.myproperty;     
    end
    function load(obj,s,wasLocked)
      % Set properties in object obj to values in structure s
      % Set private and protected properties
      obj.myproperty = s.myproperty;       
      % Set public properties and states
      load@matlab.System(obj,s,wasLocked);
    end
    
  end % methods (Access = private)
end
